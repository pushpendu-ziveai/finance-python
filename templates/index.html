<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bank Transaction PDF Upload - Python FastAPI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <h1 class="mb-4 text-center">üìä Finance PDF Analysis</h1>
        <p class="text-center text-muted mb-5">Upload your bank statement PDF and analyze transactions with AI</p>

        <!-- Upload Form -->
        <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data" class="bg-white p-4 rounded shadow-sm">
          <div class="mb-3">
            <label for="file" class="form-label">Select Bank Statement File</label>
            <input class="form-control" type="file" id="file" name="file" accept=".pdf,.jpg,.jpeg,.png" required />
            <div class="form-text">Supported formats: PDF, JPG, JPEG, PNG (max 10MB)</div>
          </div>
          
          <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg" id="uploadBtn">
              <span class="spinner-border spinner-border-sm d-none" id="uploadSpinner" role="status" aria-hidden="true"></span>
              <span id="uploadText">Upload and Process</span>
            </button>
          </div>
        </form>

        <!-- Progress and Results -->
        <div id="progressSection" class="mt-4 d-none">
          <div class="card">
            <div class="card-body text-center">
              <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Processing...</span>
              </div>
              <h5>Processing your PDF...</h5>
              <p class="text-muted">This may take a few moments depending on the document size.</p>
            </div>
          </div>
        </div>

        <div id="resultSection" class="mt-4 d-none">
          <div class="alert alert-success" role="alert">
            <h5 class="alert-heading">‚úÖ Success!</h5>
            <p id="resultMessage"></p>
            <hr>
            <div class="d-grid">
              <a href="/query" class="btn btn-success btn-lg">Analyze Transactions</a>
            </div>
          </div>
        </div>

        <div id="errorSection" class="mt-4 d-none">
          <div class="alert alert-danger" role="alert">
            <h5 class="alert-heading">‚ùå Error</h5>
            <p id="errorMessage"></p>
            <button type="button" class="btn btn-outline-danger" onclick="location.reload()">Try Again</button>
          </div>
        </div>

        <!-- Features -->
        <div class="row mt-5">
          <div class="col-md-4 text-center">
            <div class="card h-100 border-0">
              <div class="card-body">
                <h3>üîç</h3>
                <h6>Multi-Strategy Extraction</h6>
                <small class="text-muted">Advanced PDF processing with multiple fallback methods</small>
              </div>
            </div>
          </div>
          <div class="col-md-4 text-center">
            <div class="card h-100 border-0">
              <div class="card-body">
                <h3>üìÑ</h3>
                <h6>Multi-Page Support</h6>
                <small class="text-muted">Handles complex documents with transactions across multiple pages</small>
              </div>
            </div>
          </div>
          <div class="col-md-4 text-center">
            <div class="card h-100 border-0">
              <div class="card-body">
                <h3>ü§ñ</h3>
                <h6>AI Analysis</h6>
                <small class="text-muted">Ask questions about your transactions using Claude AI</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const uploadBtn = document.getElementById('uploadBtn');
      const uploadText = document.getElementById('uploadText');
      const uploadSpinner = document.getElementById('uploadSpinner');
      const progressSection = document.getElementById('progressSection');
      const resultSection = document.getElementById('resultSection');
      const errorSection = document.getElementById('errorSection');
      
      // Show loading state
      uploadBtn.disabled = true;
      uploadSpinner.classList.remove('d-none');
      uploadText.textContent = 'Processing...';
      progressSection.classList.remove('d-none');
      resultSection.classList.add('d-none');
      errorSection.classList.add('d-none');
      
      try {
        const response = await fetch('/upload', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        progressSection.classList.add('d-none');
        
        if (response.ok && result.success) {
          document.getElementById('resultMessage').textContent = result.message;
          resultSection.classList.remove('d-none');
        } else {
          throw new Error(result.detail || 'Upload failed');
        }
        
      } catch (error) {
        console.error('Upload error:', error);
        progressSection.classList.add('d-none');
        document.getElementById('errorMessage').textContent = error.message || 'An unexpected error occurred. Please try again.';
        errorSection.classList.remove('d-none');
      } finally {
        // Reset button state
        uploadBtn.disabled = false;
        uploadSpinner.classList.add('d-none');
        uploadText.textContent = 'Upload and Process';
      }
    });
  </script>
</body>
</html>